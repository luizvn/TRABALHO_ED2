<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etapa 3</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!--<link   rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
            crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script> -->

    <!--<script>
        const mapa = L.map('mapa').setView([51.505, -0.09], 13);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mapa);

    </script> -->
    
    <style>
        body{
            background-color: rgb(197, 11, 11);
        }
        /* MENU */
        .titulo{
            display: flex;
            align-items: center;
            align-content: center;
            background-color: black;
            color: white;
            margin: 0;
            padding-bottom: 20px;
            width: 100%;
        }
        .imagem_logo{
            margin-top: 10px;
            margin-right: 500px;
        }
        .texto{
            margin-left: 20px;
            text-align: center;
        }
        .nome{
            text-align: center;
            font-style: bold;
            margin-bottom: 0;
        }
        .aucunha{
            text-align: center;
            font-style: italic;
            margin-top: 5px;
        }

        nav {
            background-color: rgba(210, 77, 62, 0.7); 
            padding: 1px;
            text-align: center;
        }
        
        nav a{
            background-color: darkred;
            padding: 2px;
            color: antiquewhite;
            border: 2px solid rgb(221, 181, 181);
            margin: 20px;
        }

        /* TABELA */
        .titulo_tabela{
            text-align: center;
        }
        table{
            border-collapse: collapse;
            width: 100%;
            text-align: center;
        }
        td, th {
            border: 1px solid #dcd1d1; /* Adiciona bordas às células */
            padding: 8px; /* Adiciona espaço interno dentro das células */
        }
        /*tr:nth-child(even) {
            background-color: #f2f2f2; /* Define uma cor de fundo alternada para linhas pares 
        }*/
        th {
            background-color: #000000; /* Define uma cor de fundo para as células do cabeçalho */
            font-weight: bold; /* Deixa o texto em negrito para destacar o cabeçalho */
            text-align: center; /* Alinha o texto à esquerda no cabeçalho */
            color: whitesmoke;
        }
        tr:hover {
            background-color: #f5f5f5; /* Define uma cor de fundo quando o mouse passa sobre a linha */
        }
        /*td, th {
            padding: 10px; /* Aumenta o espaço interno dentro das células 
        } */

        /* FORMS */
        form {
            font-family: Arial, sans-serif; /* Escolha uma fonte adequada para o formulário */
        }
            
        /*input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }*/

        input[type="submit"], button {
            padding: 8px 15px;
            background-color: #3d0901;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .row .break { /* NÃO TÁ FUNCIONANDO */
            flex-basis: 100%;
            height: 0; /* Para evitar que a linha tenha altura extra */
        }

        .row label {
            flex-basis: calc(50% - 5px); /* Define a largura de cada label para ocupar metade da linha */
        }

        .row input {
            flex-basis: calc(50% - 5px); /* Define a largura de cada input para ocupar metade da linha */
        }

        .mapa {
            margin-left: auto;
            margin-right: auto;
            margin-top: 20px;
            margin-bottom: auto;
            width: 55%;
            height: 200px;
        }

    </style>
</head>
<body>
    <main>
        <header  class="titulo">
            <div class="imagem_logo">
                <a href=""><img src="src/img/logo-home.png" alt="Logo da Leão Imperial" height="120"></a>
            </div>
            <div class="texto">
                <h1 class="nome">Royal Sports</h1>
                <p class="aucunha">O Leão Imperial</p>
            </div>
        </header>
        <nav>
            <h2>
                <a class="etapa1" href="etapa1">etapa 1</a>
                <a class="etapa2" href="etapa2">etapa 2</a>
                <a class="etapa3" href="etapa3">etapa 3</a>
            </h2>
        </nav>

        <div class="container text-center">

            <h2 class="titulo_tabela"> {{ titulo}} </h2>

            <fieldset>
                <table class="table">
            
                    <thead>
                        <tr> 
                            <th>ID</th>
                
                            <th>Categoria</th>

                            <th>Tipo</th>

                            <th>Marca</th>

                            <th>Modelo</th>

                            <th>Cor</th>

                            <th>Valor</th>

                            <th>Estoque</th>
                        </tr>
                    </thead>
                
                    <tbody>
                        {% for codigo, produto in catalogo.items()%}
                            <tr>
                            
                                <td>{{codigo}}</td>

                                <td>{{produto.categoria}}</td>
                
                                <td>{{produto.tipo}}</td>

                                <td>{{produto.marca}}</td>

                                <td>{{produto.modelo}}</td>

                                <td>{{produto.cor}}</td>

                                <td>{{produto.valor}}</td>

                                <td>{{produto.estoque}}</td>
                            </tr>
                        {%endfor%}
                    </tbody>
            
                </table>
            </fieldset>
            <form method="post", action="/inserir_carrinho">
                <fieldset>
                    <div class="row">
                        <label for="chave">Insira o ID do produto desejado: <input id="chave" name="chave" type="number" required /></label>
                        <label for="quantidade">Insira a QUANTIDADE do produto desejado: <input id="quantidade" name="quantidade" type="number" required /></label>
                    </div>
                </fieldset>
                <input type="submit" value="Submit" />
            </form>
        </div>
        <div class="container text-center">

            <h2 class="titulo_tabela"> {{ titulo_carrinho}} </h2>

            <fieldset>
                <table class="table">
            
                    <thead>
                        <tr> 
                            <th>ID</th>
                
                            <th>Categoria</th>

                            <th>Tipo</th>

                            <th>Marca</th>

                            <th>Modelo</th>

                            <th>Cor</th>

                            <th>Valor</th>

                            <th>Quantidade</th>
                        </tr>
                    </thead>
                
                    <tbody>
                        {% for (codigo, produto) in carrinho.items()%}
                            <tr>
                            
                                <td>{{codigo}}</td>

                                <td>{{produto.categoria}}</td>
                
                                <td>{{produto.tipo}}</td>

                                <td>{{produto.marca}}</td>

                                <td>{{produto.modelo}}</td>

                                <td>{{produto.cor}}</td>

                                <td>{{produto.valor}}</td>

                                <td>{{produto.quantidade}}</td>
                            </tr>
                        {%endfor%}
                    </tbody>
                </table>
                <h3>Subtotal: {{subtotal}}</h3>
            </fieldset>
            <form method="post", action="/remover_carrinho">
                <fieldset>
                    <div class="row">
                        <label for="chave">Insira o ID do produto que deseja excluir: <input id="chave" name="chave" type="number" required /></label>
                    </div>
                </fieldset>
                <input type="submit" value="Submit" />
            </form>
            <h3>Calcular o frete</h3>
        
        </div>
        <div class="mapa">
            <fieldset>
                {{ mapa_html | safe }}
            </fieldset>
        </div>
        <form id="carrinhoForm" method="post", action="/confirmar_carrinho">
            <fieldset>
                <div class="row"></div>
                    <label for="chave">Insira o local à ser entregue: <input id="chave" name="chave" type="text" required /></label>
                </div>
            </fieldset>
            <input type="submit" value="Submit">
        </form>

        <h3>Finalizar Pedido</h3>
        <form method="post", action="/finalizar_pedido">
            <input type="submit" value="Submit" id="finalizar">
        </form>

        <!-- JAVA SCRIPT -->
        <script>
            $(document).ready(function() {
                $('#carrinhoForm').submit(function(event) {
                    event.preventDefault(); // Impede o envio padrão do formulário
    
                    $.ajax({
                        url: '/confirmar_carrinho',
                        type: 'POST',
                        data: $(this).serialize(),
                        success: function(retorno) {
                            if (retorno.subtotal !== undefined) {
                                $('#resultado').text('Subtotal: ' + retorno.subtotal);
                            } else if (retorno.error !== undefined) {
                                alert('Erro: ' + retorno.error);
                            }
                        },
                        error: function(xhr, status, error) {
                            /*console.error('Status:', status); // Log do status
                            console.error('Erro:', error); // Log do erro
                            console.error('Resposta:', xhr.responseText); // Log da resposta   */ 
                            alert('Erro na solicitação: ' + xhr.responseText);
                        }
                    });
                });
            });
        </script>
    </main>
</body>
</html>